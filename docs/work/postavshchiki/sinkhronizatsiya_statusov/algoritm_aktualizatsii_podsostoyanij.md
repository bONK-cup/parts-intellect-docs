---
title: Алгоритм актуализации подсостояний у позиций заказов поставщикам
createTime: 2025/05/30 22:02:20
---
При актуализации подсостояний у позиций **Заказа поставщику** с информацией о текущих статусах от поставщиков используется особый алгоритм сопоставления данных в программе и данных от поставщика.

::: note Замечание

Алгоритм описан для общего случая и применяется как при актуализации с помощью файла от поставщика, так и в случае использования сервиса актуализация.

:::

- На входе алгоритма имеется набор транзакций из программы (которым требуется обновить подсостояния) и набор позиций из источника (которыми обновляются подсостояния, из файла либо сервиса Веб-заказ). В дополнение передается "ключ", по которому осуществляется состыковка позиций (свойства позиции ЗП, либо один из референсов);

- Затем в зависимости от источника обновления:

    - Если через импорт файла, то в файле по "ключу" отбираются коллекции записей с идентичным ключом. Затем по каждой коллекции (по ключу) формируется коллекция транзакций из программы с таким же "ключом";

    - Если через сервис, то наоборот: формируется коллекция позиций в программе по "ключу", а затем каждый уникальный ключ направляется в сервис Веб-заказ;

- Особенность подбора коллекций из программы. Программа по "ключу" подбирает как транзакции в состоянии "заказ поставщику", так и, если анализирует транзакции в других состояниях, но с тем же "ключом". Программа просматривает историю транзакций назад до ближайшего момента в состоянии "заказ поставщику". Затем из ответа от сервиса либо файла отфильтровывает позиции с таким же "ключом" и подсостоянием (с учетом количества). А затем применяется алгоритм, описанный ниже;

- Если "ключ" коллекции найден только в одном источнике, то эта коллекция не обновляется;

- Если статус от поставщика не распознан (нет соответствия с парой "Состояние-Подсостояние" в карточке поставщика на вкладке Веб-заказ), то позиция источника игнорируется;

- Далее идет перебор коллекций:

    - Статус из источника преобразуется в подсостояние программы с помощью справочника из [карточки поставщика](../redaktirovanie_postavshchikov.md);

    - Затем берутся две коллекции (из Parts.Intellect и источника) с идентичным "ключом" и начинается сверка и обновление;

    - Ошибочные ситуации выводятся в лог-файл. Не нашлось соответствие текста статуса от поставщика и подсостояния "заказ поставщику" в карточке поставщика и т.д.

<table><thead><tr><th>Позиций в коллекции из программы (Parts.Intellect)</th><th>Позиций в коллекции из источника (файл либо сервис Веб-заказ)</th><th>Количество штук товара в коллекции из Parts.Intellect сравниваем с источником</th><th>Действие</th></tr></thead>
<tbody><tr><td rowspan="3">1</td><td rowspan="3">1</td><td><b>=</b></td><td valign="top">Обновляется статус, если он сменился</td></tr>
<tr><td><b>></b></td><td valign="top">Дробится позиция в программе и устанавливается новый статус</td></tr>
<tr><td><b><</b></td><td valign="top">Обновляется статус на количество из программы</td></tr>
<tr><td rowspan="3">N</td><td rowspan="3">1</td><td><b>=</b></td><td valign="top">Всем позициям программы устанавливается статус из источника</td></tr>
<tr><td><b>></b></td><td valign="top">Позициям из программы устанавливается новый статус, начиная с позиций с самой старой датой обновления подсостояния</td></tr>
<tr><td><b><</b></td><td valign="top">Всем позициям программы устанавливается статус из источника</td></tr>
<tr><td rowspan="3">1</td><td rowspan="3">N</td><td><b>=</b></td><td valign="top">Дробится позиция в программе и устанавливаются новые подсостояния</td></tr>
<tr><td><b>></b></td><td valign="top">Дробится позиция в программе и устанавливаются новые подсостояния. Остаток позиций программе имеет прежнее подсостояние.</td></tr>
<tr><td><b><</b></td><td valign="top">Позициям из программы устанавливается новый статус. Сортировка позиций источника по порядку, в котором они следуют в источнике.</td></tr>
<tr><td rowspan="3">N</td><td rowspan="3">M</td><td><b>=</b></td><td valign="top">1. Определяется разница, задается соответствие программа-источник. Позиции коллекций, чьи статусы совпадают, уходят из алгоритма с учетом их остатка. На выходе позиции программы и Источника, которые необходимо состыковать. А остальные позиции не изменили статус и не требуют актуализации.<br>2. Присваиваются статусы с минимальным количеством раздробленных позиций программы.<br>2.1 Сразу применяются статусы с одинаковым количеством. 1-1, 2-2, 3-3,...<br>2.2 Оставшиеся позиции обновляются по порядку. Сортировка по дате обновления подсостояния, от старых к новым.</td></tr>
<tr><td><b>></b></td><td valign="top">1. Определяется разница, задается соответствие программа-источник. Позиции коллекций, чьи статусы совпадают, уходят из алгоритма с учетом их остатка. На выходе позиции программы и Источника, которые необходимо состыковать. А остальные позиции не изменили статус и не требуют актуализации.<br>2. Присваиваются статусы с минимальным количеством раздробленных позиций программы.<br>2.1 Сразу применяются статусы с одинаковым количеством. 1-1, 2-2, 3-3,...<br>2.2 Оставшиеся позиции обновляются по порядку. Сортировка по дате обновления подсостояния, от старых к новым.<br>3. Алгоритм заканчивается, когда коллекция из файла полностью потрачена.</td></tr>
<tr><td><b><</b></td><td valign="top">1. Определяется разница, задается соответствие программа-источник. Позиции коллекций, чьи статусы совпадают, уходят из алгоритма с учетом их остатка. На выходе позиции программы и Источника, которые необходимо состыковать. А остальные позиции не изменили статус и не требуют актуализации.<br>2. Присваиваются статусы с минимальным количеством раздробленных позиций программы.<br>2.1 Сразу применяются статусы с одинаковым количеством. 1-1, 2-2, 3-3,...<br>2.2 Оставшиеся позиции обновляются по порядку. Сортировка по дате обновления подсостояния, от старых к новым.<br>3. Алгоритм заканчивается, когда коллекция из программы полностью потрачена.</td></tr></tbody></table>



